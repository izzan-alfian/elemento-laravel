const apiUrl = "https://elemento-api.fly.dev/api/v1";

const apiRoutes = {
    register: `${apiUrl}/register`,
    login: `${apiUrl}/login`,
    modul: `${apiUrl}/module`,
    modulBab: `${apiUrl}/module/bab`,
    magicCard: `${apiUrl}/magic-card`,
    magicCardSenyawa: `${apiUrl}/magic-card/senyawa`,
    quiz: `${apiUrl}/quiz`,
    quizQuestions: `${apiUrl}/question-quiz`,
    quizAddQuestion: `${apiUrl}/quiz/:id/question`,
    quizAddAnswer: `${apiUrl}/quiz/question/:id/answer`,
    feedback: `${apiUrl}/feedback`,
}

$.ajaxSetup({
    dataType: "json",
    contentType: "application/json",
    error: function(error) {
        console.log(error)
    }
});

function validateNumberInput(input, canBeNegative=false, lowerThanZero=false) {
    const inputValue = input.value
    let isValid
    if (canBeNegative) {
        isValid = /^-?\d*\,?\d*$/.test(inputValue)
    }else {
        isValid = /^\d*\,?\d*$/.test(inputValue)
    }

    if (!isValid) {
        if (canBeNegative)
            input.value = inputValue.replace(/[^-,\d]/g, '')
        else
            input.value = inputValue.replace(/[^\d]/g, '')
    }

    if (!lowerThanZero) {
        input.value = input.value < 0 ? '' : input.value
    }
}

function formDataToJson(formData){
    var object = {};
    formData.forEach(function(value, key){
        object[key] = value;
    });
    return JSON.stringify(object);
}

function token() {
    user = $.cookie('user')
    if (typeof user == 'object')
        return user.accessToken

    return "";
}

function validatorHandler(error, element){
    error = JSON.stringify(error.responseJSON).split("Error:").map(function(element, index) {
        if (index == 0)
            return null;

        if (element.includes("Key:"))
            return "<li>"+element.split("\\n")[0]+"</li>"

        return element
    }).filter(function (element, index) {
        return element != null;
    }).join('')

    html = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        <ul>
            ${error}
        </ul>
    </div>`

    element.append(html)
}

$(function () {
    // Admin Panel settings

    //****************************
    /* This is for the mini-sidebar if width is less then 1170*/
    //****************************
    var setsidebartype = function () {
        var width =
            window.innerWidth > 0 ? window.innerWidth : this.screen.width;
        if (width < 1199) {
            $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
            $("#main-wrapper").addClass("mini-sidebar");
        } else {
            $("#main-wrapper").attr("data-sidebartype", "full");
            $("#main-wrapper").removeClass("mini-sidebar");
        }
    };
    $(window).ready(setsidebartype);
    $(window).on("resize", setsidebartype);
    //****************************
    /* This is for sidebartoggler*/
    //****************************
    $(".sidebartoggler").on("click", function () {
        $("#main-wrapper").toggleClass("mini-sidebar");
        if ($("#main-wrapper").hasClass("mini-sidebar")) {
            $(".sidebartoggler").prop("checked", !0);
            $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
        } else {
            $(".sidebartoggler").prop("checked", !1);
            $("#main-wrapper").attr("data-sidebartype", "full");
        }
    });
    $(".sidebartoggler").on("click", function () {
        $("#main-wrapper").toggleClass("show-sidebar");
    });
})
